#!/bin/bash
# NXTG-Forge Pre-commit Hook
# Prevents accidental commit of state files and build artifacts

# ANSI color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}üîç NXTG-Forge Pre-commit Check${NC}"

# Check for state files
STATE_FILES=$(git diff --cached --name-only | grep -E "(state\.json|\.state\.json)" || true)

if [ ! -z "$STATE_FILES" ]; then
    echo -e "${RED}‚ùå ERROR: Attempting to commit state files!${NC}"
    echo -e "${YELLOW}The following state files should never be committed:${NC}"
    echo "$STATE_FILES" | while read -r file; do
        echo "  ‚Ä¢ $file"
    done
    echo ""
    echo -e "${YELLOW}To fix this:${NC}"
    echo "  1. Remove from staging: git reset HEAD <file>"
    echo "  2. Add to .gitignore if not already there"
    echo "  3. Run: ./scripts/clean-artifacts.sh"
    echo ""
    exit 1
fi

# Check for build artifacts
ARTIFACTS=$(git diff --cached --name-only | grep -E "(\.pyc$|__pycache__|\.egg-info|dist/|htmlcov/|\.coverage$)" || true)

if [ ! -z "$ARTIFACTS" ]; then
    echo -e "${RED}‚ùå ERROR: Attempting to commit build artifacts!${NC}"
    echo -e "${YELLOW}The following artifacts should not be committed:${NC}"
    echo "$ARTIFACTS" | while read -r file; do
        echo "  ‚Ä¢ $file"
    done
    echo ""
    echo -e "${YELLOW}To fix this:${NC}"
    echo "  Run: ./scripts/clean-artifacts.sh"
    echo ""
    exit 1
fi

echo -e "${GREEN}‚úÖ Pre-commit check passed!${NC}"
exit 0